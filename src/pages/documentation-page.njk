{% extends "__layout.njk" %}

{% block Link %}
	<link rel="stylesheet" href="css/flatpickr.min.css">
	<link rel="stylesheet" href="css/choices.min.css">
{% endblock %}

{% block Header %}
	{% include "include/blue-line.njk" %}
	<div class="breadcrumbs">
		<div class="container">
			<ul class="breadcrumbs__list">
				<li class="breadcrumbs__item">
					<a href="" class="breadcrumbs__link">Главная</a>
					<svg>
						<use xlink:href="img/sprite.svg#svg--arrow-two">
					</svg>
				</li>
				<li class="breadcrumbs__item">
					<a href="" class="breadcrumbs__link">Пункт меню</a>
					<svg>
						<use xlink:href="img/sprite.svg#svg--arrow-two">
					</svg>
				</li>
				<li class="breadcrumbs__item">
					<a href="" class="breadcrumbs__link">Пункт меню</a>
					<svg>
						<use xlink:href="img/sprite.svg#svg--arrow-two">
					</svg>
				</li>
				<li class="breadcrumbs__item">
					<span class="breadcrumbs__link">Главные новости</span>
				</li>
			</ul>
		</div>
	</div>
{% endblock %}

{% block Content %}
	<section class="content-page">
		<div class="container">
			<div class="row-title row-title--change">
				<h2 class="title"><a href="#">Документы администрации</a> / <a href="#" class="link-active">Документы городской Думы</a></h2>
			</div>
		</div>
		<div class="filter-documentation gray-bg">
			<div class="container">
				<form action="" class="filter-documentation__form">
					<div class="filter-documentation__wrapper">
						<div class='filter-documentation__wrap filter-documentation__wrap--select'>
							<span class='wrap-field__description'>Категория:</span>
							<div class='select-wrap' id='category'>
								<select class='select select-category-document'>
									<option placeholder>Все документы</option>
									<option value='1'>1</option>
									<option value='2'>2</option>
									<option value='3'>3</option>
									<option value='4'>4</option>
								</select>
							</div>
						</div>
						<div class="filter-documentation__wrap filter-documentation__wrap--name">
							<div class="wrap-field">
								<label>
									<span class="wrap-field__description">Название документа:</span>
									<input type="text" class="wrap-field__field" placeholder="Введите название">
								</label>
							</div>
						</div>
						<div class="filter-documentation__wrap filter-documentation__wrap--date">
							<div class="wrap-field">
								<label>
									<span class="wrap-field__description">Дата подписания с:</span>
									<input type="tel" id="date-from" class="wrap-field__field" placeholder="ДД.ММ.ГГГГ">
									<svg>
										<use xlink:href="img/sprite.svg#svg--calendar-icon">
									</svg>
								</label>
							</div>
						</div>
						<div class="filter-documentation__wrap filter-documentation__wrap--date">
							<div class="wrap-field">
								<label>
									<span class="wrap-field__description">по:</span>
									<input type="tel" id="date-to" class="wrap-field__field" placeholder="ДД.ММ.ГГГГ">
									<svg>
										<use xlink:href="img/sprite.svg#svg--calendar-icon">
									</svg>
								</label>
							</div>
						</div>
						<div class="filter-documentation__wrap filter-documentation__wrap--number">
							<div class="wrap-field">
								<label>
									<span class="wrap-field__description">Название документа:</span>
									<input type="text" class="wrap-field__field" placeholder="Введите номер">
								</label>
							</div>
						</div>
					</div>
				</form>
			</div>
		</div>
		<div class="documentation-sect">
			<div class="container">
				<div class="documentation-sect__wrapper">
					<div class="documentation-sect__row">
						<div class="news-post">
              <div class="news-post__wrapper">
                <div class="news-post__row">
                  <span class="info-text date">05 марта 2021, 10:24</span>
                  <a href="#" class="topic-item topic-item--change topic-item--change-collor">
                    <div class="topic-item__wrapper">
                      <span class="topic-item__text">Национальные проекты</span>
                    </div>
                  </a>
                </div>
                <a href="#" class="news-post__wrap-text">
                  <h3>Решение городской Думы Краснодара от 17.12.2020 № 5 п. 6 «Об опубликовании проекта решения городской Думы Краснодара «О внесении изменений в Устав муниципального образования город Краснодар»</h3>
                </a>
              </div>
            </div>
					</div>
					<div class="documentation-sect__row">
						<div class="news-post">
              <div class="news-post__wrapper">
                <div class="news-post__row">
                  <span class="info-text date">05 марта 2021, 10:24</span>
                </div>
                <a href="#" class="news-post__wrap-text">
                  <h3>Заключение о результатах публичных слушаний по проекту решения городской Думы Краснодара «О внесении изменений в Устав муниципального образования город Краснодар»</h3>
                </a>
              </div>
            </div>
					</div>
					<div class="documentation-sect__row">
						<div class="news-post">
              <div class="news-post__wrapper">
                <div class="news-post__row">
                  <span class="info-text date">05 марта 2021, 10:24</span>
                  <a href="#" class="topic-item topic-item--change topic-item--change-collor">
                    <div class="topic-item__wrapper">
                      <span class="topic-item__text">Национальные проекты</span>
                    </div>
                  </a>
                </div>
                <a href="#" class="news-post__wrap-text">
                  <h3>Порядок обжалования нормативных правовых актов и иных решений, принятых администрацией муниципального образования город Краснодар</h3>
                </a>
              </div>
            </div>
					</div>
					<div class="documentation-sect__row">
						<div class="news-post">
              <div class="news-post__wrapper">
                <div class="news-post__row">
                  <span class="info-text date">05 марта 2021, 10:24</span>
                </div>
                <a href="#" class="news-post__wrap-text">
                  <h3>Решение городской Думы Краснодара от 17.12.2020 № 5 п. 6 «Об опубликовании проекта решения городской Думы Краснодара «О внесении изменений в Устав муниципального образования город Краснодар»</h3>
                </a>
              </div>
            </div>
					</div>
				</div>
			</div>
		</div>
		<div class="pagination">
			<div class="container">
				<div class="pagination__wrapper">
					<div class="pagination__left">
						<a href="#" class="btn-white">
							<svg>
								<use xlink:href="img/sprite.svg#svg--arrow-two"></use>
							</svg>
							<span class="btn-white__text">Предыдущая</span>
						</a>
					</div>
					<ul class="pagination__list">
						<li class="pagination__item"><a href="#" class="pagination__link">1</a></li>
						<li class="pagination__item"><a href="#" class="pagination__link pagination__link--active">2</a></li>
						<li class="pagination__item"><a href="#" class="pagination__link">3</a></li>
						<li class="pagination__item"><a href="#" class="pagination__link">4</a></li>
						<li class="pagination__item"><a href="#" class="pagination__link">5</a></li>
						<li class="pagination__item"><a href="#" class="pagination__link">6</a></li>
						<li class="pagination__item"><a href="#" class="pagination__link pagination__link--dotted">...</a></li>
						<li class="pagination__item"><a href="#" class="pagination__link">8</a></li>
					</ul>
					<div class="pagination__right">
						<a href="#" class="btn-white">
							<svg>
								<use xlink:href="img/sprite.svg#svg--arrow-two"></use>
							</svg>
							<span class="btn-white__text">Предыдущая</span>
						</a>
					</div>
				</div>
			</div>
		</div>
		<div class="row-btn">
			<div class="container">
				<a href="#" class="btn-white"><span class="btn-white__text">Загрузить предыдущие документы</span></a>
			</div>
		</div>
	</section>
	{% include "include/modal.njk" %}
{% endblock %}

{% block Scripts %}
	<script src="js/flatpickr.js"></script>
	<script src="js/flatpickr-ru.js"></script>
	<script src="js/choices.min.js"></script>
	<script>
		const choices = new Choices('.select', {
			itemSelectText: '',
			searchEnabled: false,
			placeholder: true,
		});

		let calendarDateFrom = flatpickr("#date-from", {
			"locale": "ru",
			dateFormat: "Y-m-d",
			monthSelectorType: "static",
			nextArrow: "<svg width='18' height='21' viewBox='0 0 18 21' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M9 1L9 19M9 19L17 10.9543M9 19L1 10.9543' stroke-width='2' stroke-linecap='round'/></svg>",
			prevArrow: "<svg width='18' height='21' viewBox='0 0 18 21' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M9 1L9 19M9 19L17 10.9543M9 19L1 10.9543' stroke-width='2' stroke-linecap='round'/></svg>",
		});
		let calendarDateTo = flatpickr("#date-to", {
			"locale": "ru",
			dateFormat: "Y-m-d",
			monthSelectorType: "static",
			nextArrow: "<svg width='18' height='21' viewBox='0 0 18 21' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M9 1L9 19M9 19L17 10.9543M9 19L1 10.9543' stroke-width='2' stroke-linecap='round'/></svg>",
			prevArrow: "<svg width='18' height='21' viewBox='0 0 18 21' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M9 1L9 19M9 19L17 10.9543M9 19L1 10.9543' stroke-width='2' stroke-linecap='round'/></svg>",
		});

		(function () {
			fetch('js/categoryDocument.json').then(response => response.json()).then(data => {
					let choicesTwo;
					window.addEventListener("change", function (event) {
						if (event.target.classList.contains('select-category-document')) {
							const selectWrap = document.querySelector('#category');
							const resultSelectCategory = selectWrap.querySelector('.choices__item--selectable');

							if(document.querySelector('[data-new-list]')) {
								choicesTwo.destroy();
								document.querySelector('[data-new-list]').remove();
								document.querySelector('.filter-documentation__wrap--name').classList.remove('filter-documentation__wrap--change-width');
							}

							data.forEach(function(item) {
								if (item.nameCategory === resultSelectCategory.textContent) {
									selectWrap.closest('.filter-documentation__wrap--select').insertAdjacentHTML(
									'afterend', 
									`<div class='filter-documentation__wrap filter-documentation__wrap--select' data-new-list><div class='select-wrap'><select class='select' placeholder='Документы категория'></select></div></div>`
									);

									const newList = document.querySelector('[data-new-list] select');
									newList.insertAdjacentHTML('afterbegin', `<option placeholder value='Выберите документ'>Выберите документ</option>`);
									
									item.listDocument.forEach(function(document) {
										console.log(document);
										newList.insertAdjacentHTML('beforeend', `<option value='${document}'>${document}</option>`);
									});

									choicesTwo = new Choices('[data-new-list] select', {
										itemSelectText: '',
										searchEnabled: false,
										placeholder: true,
									});

									if (document.querySelector('[data-new-list]').nextElementSibling.classList.contains('filter-documentation__wrap--name')) {
										document.querySelector('[data-new-list]').nextElementSibling.classList.add('filter-documentation__wrap--change-width')
									}
								}
							});
						};
					});
				});			
		})();

		(function () {
			const filterForm = document.querySelector('.filter-documentation__form');
			const listDocument = document.querySelector('.documentation-sect__wrapper');
			let count;
			let interval;

			function timer () {
				clearInterval(interval);
				count = 12;
				interval = setInterval(() => {
					count--;
					console.log('count: ', count--);

					if (count <= 0) {
						clearInterval(interval);
						// Здесь скрипт обращения к json
						listDocument.querySelectorAll('*').forEach(function(i) {
							i.remove();
						});

						fetch('js/documentList.json').then(response => response.json()).then(data => {
							data.forEach(function(item) {
								console.log(item.category);
								console.log(item.date);
								console.log(item.listDocument);
								listDocument.insertAdjacentHTML('beforeend', `<div class='documentation-sect__row'><div class='news-post'><div class='news-post__wrapper'><div class='news-post__row'><span class='info-text date'>${item.date}</span><a href='#' class='topic-item topic-item--change topic-item--change-collor'><div class='topic-item__wrapper'><span class='topic-item__text'></span></div></a></div><a href='#' class='news-post__wrap-text'><h3></h3></a></div></div></div>`)
							})
						});

						// Здесь скрипт обращения к json -- end
					}
				}, 200);
			}

			document.addEventListener('input', function(event) {
				timer()
			});

			document.addEventListener('change', function(event) {
				timer()
			});

			
		})();
		
	</script>
	
{% endblock %}